"use strict";var _require=require("../server"),io=_require.io,_require2=require("../classes/usuarios"),Usuarios=_require2.Usuarios,_require3=require("../utilidades/utilidades"),crearMensaje=_require3.crearMensaje,usuarios=new Usuarios;io.on("connect",function(s){s.on("entrarChat",function(a,r){if(!a.nombre||!a.sala)return r({error:!0,mensaje:"El nombre/sala es necesario"});s.join(a.sala),usuarios.agregarPersona(s.id,a.nombre,a.sala),s.broadcast.to(a.sala).emit("listaPersona",usuarios.getPersonasPorSala(a.sala)),r(usuarios.getPersonasPorSala(a.sala))}),s.on("crearMensaje",function(a){var r=usuarios.getPersona(s.id),e=crearMensaje(r.nombre,a.mensaje);s.broadcast.to(r.sala).emit("crearMensaje",e)}),s.on("disconnect",function(){var a=usuarios.borrarPersona(s.id);s.broadcast.to(a.sala).emit("crearMensaje",crearMensaje("Administrador","".concat(a.nombre," salio"))),s.broadcast.to(a.sala).emit("listaPersona",usuarios.getPersonasPorSala(a.sala))}),s.on("mensajePrivado",function(a){var r=usuarios.getPersona(s.id);s.broadcast.to(a.para).emit("mensajePrivado",crearMensaje(r.nombre,a.mensaje))})});