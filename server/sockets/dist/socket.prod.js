"use strict";var _require=require("../server"),io=_require.io,_require2=require("../classes/usuarios"),Usuarios=_require2.Usuarios,_require3=require("../utilidades/utilidades"),crearMensaje=_require3.crearMensaje,usuarios=new Usuarios;io.on("connect",function(o){o.on("entrarChat",function(a,e){if(!a.nombre||!a.sala)return e({error:!0,mensaje:"El nombre/sala es necesario"});o.join(a.sala),usuarios.agregarPersona(o.id,a.nombre,a.sala),o.broadcast.to(a.sala).emit("listaPersona",usuarios.getPersonasPorSala(a.sala)),o.broadcast.to(a.sala).emit("crearMensaje",crearMensaje("Administrador","".concat(a.nombre," se unio"))),e(usuarios.getPersonasPorSala(a.sala))}),o.on("crearMensaje",function(a,e){var r=usuarios.getPersona(o.id),s=crearMensaje(r.nombre,a.mensaje);o.broadcast.to(r.sala).emit("crearMensaje",s),e(s)}),o.on("disconnect",function(){var a=usuarios.borrarPersona(o.id);o.broadcast.to(a.sala).emit("crearMensaje",crearMensaje("Administrador","".concat(a.nombre," salio"))),o.broadcast.to(a.sala).emit("listaPersona",usuarios.getPersonasPorSala(a.sala))}),o.on("mensajePrivado",function(a){var e=usuarios.getPersona(o.id);o.broadcast.to(a.para).emit("mensajePrivado",crearMensaje(e.nombre,a.mensaje))})});